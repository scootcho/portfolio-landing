
<!DOCTYPE HTML>

<html>

<head>
	<meta charset="utf-8">
	<title>Lesson 2: CSV &amp; Email - Continue - Assemblying Scottbot</title>
	<meta name="author" content="Scott Yu">

	
	<meta name="description" content="Lesson 2: CSV &amp; Email - Continue 5 hrs I finished the JavaScript Track today. Woot! Check out my badges! The final project was to build a cash &hellip;">
	

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

	<link href="/atom.xml" rel="alternate" title="Assemblying Scottbot" type="application/atom+xml">
	
	<link rel="canonical" href="http://scootcho.github.io/blog/2014/07/12/lesson-2-csv-and-email-continue/">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="/stylesheets/font-awesome.min.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<link href='http://fonts.googleapis.com/css?family=Nunito:400,300,700' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
  

</head>


<body>
	<div class="container">
		<div class="left-col">
			<div class="intrude-less">
			<header id="header" class="inner"><div class="profilepic">
	
	<script src="/javascripts/md5.js"></script>
	<script type="text/javascript">
		$(function(){
			$('.profilepic').append("<img src='http://www.gravatar.com/avatar/" + MD5("scott.tj.yu@gmail.com") + "?s=160' alt='Profile Picture' style='width: 160px;' />");
		});
	</script>
	
</div>

<nav id="main-nav">
<br>
<section class="aboutme">
  <p>
    I'm Scott and this is where I share my programming learning experience and other things of interest.
  </p>
</section>
<br>


<ul class="main">
    <li><a href="/">Blog</a></li>
    <li><a href="/blog/about">About</a></li>
    <li><a href="/blog/archives">Archives</a></li>
</ul></nav>
<nav id="sub-nav">
	<div class="social">
		
			<a class="email" href="mailto:scott.tj.yu@gmail.com" title="Email">Email</a>
		
		
		
		
			<a class="twitter" href="http://twitter.com/scootcho" title="Twitter">Twitter</a>
		
		
			<a class="github" href="https://github.com/scootcho" title="GitHub">GitHub</a>
		
		
		
		
		
		
		
		
		
		
    	
    	
			<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
</nav>
</header>				
			</div>
		</div>	
		<div class="mid-col">
			
				
			
			<div class="mid-col-container">
				<div id="content" class="inner"><article class="post" itemscope itemtype="http://schema.org/BlogPosting">
	<h1 class="title" itemprop="name">Lesson 2: CSV &amp; Email - Continue</h1>
	<div class="entry-content" itemprop="articleBody"><p>5 hrs</p>

<p>I finished the <a href="http://www.codecademy.com/tracks/javascript">JavaScript Track</a> today. Woot! Check out my <a href="http://www.codecademy.com/users/scottyu/achievements">badges</a>! The final project was to build a cash register that can &ldquo;scan&rdquo; different items and quantities then calculate the total amount. It was interesting to use the <code>add</code> method in the <code>scan</code> method within the same object. A nested function:</p>

<figure class='code'><figcaption><span>Cash Register</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">cashRegister</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>    <span class="nx">total</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">lastTransactionAmount</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span><span class='line'>    <span class="nx">add</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">itemCost</span><span class="p">){</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">total</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">itemCost</span> <span class="o">||</span> <span class="mi">0</span><span class="p">);</span>
</span><span class='line'>        <span class="k">this</span><span class="p">.</span><span class="nx">lastTransactionAmount</span> <span class="o">=</span> <span class="nx">itemCost</span><span class="p">;</span>
</span><span class='line'>    <span class="p">},</span>
</span><span class='line'>    <span class="nx">scan</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span><span class="nx">quantity</span><span class="p">){</span>
</span><span class='line'>        <span class="k">switch</span> <span class="p">(</span><span class="nx">item</span><span class="p">){</span>
</span><span class='line'>        <span class="k">case</span> <span class="s2">&quot;eggs&quot;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="mf">0.98</span> <span class="o">*</span> <span class="nx">quantity</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="s2">&quot;milk&quot;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="mf">1.23</span> <span class="o">*</span> <span class="nx">quantity</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="s2">&quot;magazine&quot;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="mf">4.99</span> <span class="o">*</span> <span class="nx">quantity</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="k">case</span> <span class="s2">&quot;chocolate&quot;</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="mf">0.45</span> <span class="o">*</span> <span class="nx">quantity</span><span class="p">);</span> <span class="k">break</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>    <span class="p">),</span>
</span><span class='line'>    <span class="p">.</span>
</span><span class='line'>    <span class="p">.</span>
</span><span class='line'>    <span class="p">.</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="nx">cashRegister</span><span class="p">.</span><span class="nx">scan</span><span class="p">(</span><span class="s1">&#39;eggs&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
</span><span class='line'><span class="nx">cashRegister</span><span class="p">.</span><span class="nx">scan</span><span class="p">(</span><span class="s1">&#39;milk&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// Show the total bill</span>
</span><span class='line'><span class="c1">//toFixed, number into a string, keeping only two decimal</span>
</span><span class='line'><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Your bill is &#39;</span><span class="o">+</span><span class="nx">cashRegister</span><span class="p">.</span><span class="nx">total</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>




<!--more-->




<br/>


<p>I also came back around to work on my <a href="https://www.makeitwithcode.com">MakeItWithCode</a> assignment. <a href="/blog/2014/07/12/lesson-2-csv-and-email/">Last HW</a> I used the mailgun gem to send myself an email. The goal this time is to combine powers from twitter, mailgun, and csv gems. To send myself an email attached with twitter seach results in a spreadsheet!</p>

<p>After figuring out how to create and send a csv file through MailGun, I was left with working out how to put them together.</p>

<p>Instead of sending hard-coded info like this:</p>

<figure class='code'><figcaption><span>Cash Register</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">CSV</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&quot;my_results.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="nx">csv</span><span class="o">|</span>
</span><span class='line'>  <span class="nx">csv</span> <span class="o">&lt;&lt;</span> <span class="p">[</span><span class="s2">&quot;firstname&quot;</span><span class="p">,</span> <span class="s2">&quot;lastname&quot;</span><span class="p">,</span> <span class="s2">&quot;phone&quot;</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">]</span>
</span><span class='line'>  <span class="nx">csv</span> <span class="o">&lt;&lt;</span> <span class="p">[</span><span class="s2">&quot;scott&quot;</span><span class="p">,</span> <span class="s2">&quot;yu&quot;</span><span class="p">,</span> <span class="s2">&quot;888-8888&quot;</span><span class="p">,</span> <span class="s2">&quot;scott@robots.com&quot;</span><span class="p">]</span>
</span><span class='line'><span class="nx">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>I need to search the twitter feed and put the result in a CSV file. Which means, I can&rsquo;t just use the above example as the search results will all be put in a single row because of the <code>csv &lt;&lt; []</code> iteration.</p>

<p>What I need is a nested iteration that will first open a CSV file and write the results line by line into the file.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">CSV</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;tweet_result.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">csv</span><span class="o">|</span>
</span><span class='line'>    <span class="n">client</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;learn to code&quot;</span><span class="p">,</span> <span class="ss">:result_type</span> <span class="o">=&gt;</span> <span class="s2">&quot;recent&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">tweet</span><span class="o">|</span>
</span><span class='line'>        <span class="n">csv</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="n">tweet</span><span class="o">.</span><span class="n">text</span><span class="o">]</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<br />


<p>Here is the completed script :)</p>

<figure class='code'><figcaption><span>twitter_spreadsheet_email.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;mailgun&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;csv&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;twitter&#39;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">client</span> <span class="o">=</span> <span class="ss">Twitter</span><span class="p">:</span><span class="ss">:REST</span><span class="o">::</span><span class="no">Client</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">consumer_key</span>    <span class="o">=</span> <span class="s2">&quot;xxxxxxxxxxxxxxxxxx&quot;</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">consumer_secret</span> <span class="o">=</span> <span class="s2">&quot;xxxxxxxxxxxxxxxxxx&quot;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="no">CSV</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;tweet_result.csv&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">csv</span><span class="o">|</span>
</span><span class='line'>    <span class="n">client</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;learn to code&quot;</span><span class="p">,</span> <span class="ss">:result_type</span> <span class="o">=&gt;</span> <span class="s2">&quot;recent&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">take</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">tweet</span><span class="o">|</span>
</span><span class='line'>        <span class="n">csv</span> <span class="o">&lt;&lt;</span> <span class="o">[</span><span class="n">tweet</span><span class="o">.</span><span class="n">text</span><span class="o">]</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">tweets</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;tweet_result.csv&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="no">Mailgun</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="s1">&#39;private-API-key-XXXXXXXXXXXXXXXX&#39;</span>
</span><span class='line'>  <span class="n">config</span><span class="o">.</span><span class="n">domain</span>  <span class="o">=</span> <span class="s1">&#39;sandbox12345.mailgun.org&#39;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="vi">@mailgun</span> <span class="o">=</span> <span class="no">Mailgun</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
</span><span class='line'>  <span class="ss">:to</span> <span class="o">=&gt;</span> <span class="s2">&quot;scott@robot.com&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:subject</span> <span class="o">=&gt;</span> <span class="s2">&quot;Email from a robot&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:text</span> <span class="o">=&gt;</span> <span class="s2">&quot;Beep beep...beep..keep programming awesome stuff! Btw, NSA is watching!!&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">:from</span> <span class="o">=&gt;</span> <span class="s2">&quot;scott@sandbox12345.mailgun.org&#39;,</span>
</span><span class='line'><span class="s2">  :attachment =&gt; File.new(tweets)</span>
</span><span class='line'><span class="s2">}</span>
</span><span class='line'><span class="s2">@mailgun.messages.send_email(parameters)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Woot! I got the tweets attachment in my email!</p>

<p><img class="center" src="/images/tweetcsv.png"></p>
</div>

</article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>



<section id="comment">
    <h1 class="title">Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
			</div>
			<footer id="footer" class="inner">Copyright &copy; 2014

    Scott Yu


Design credit: <a href="http://shashankmehta.in/archive/2012/greyshade.html">Shashank Mehta</a></footer>
		</div>
	</div>
	

<script type="text/javascript">
      var disqus_shortname = 'scottbot';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://scootcho.github.io/blog/2014/07/12/lesson-2-csv-and-email-continue/';
        var disqus_url = 'http://scootcho.github.io/blog/2014/07/12/lesson-2-csv-and-email-continue/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




</body>
</html>
